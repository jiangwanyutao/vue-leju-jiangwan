(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62c2089e"],{"1b62":function(e,t,s){"use strict";var a=s("03e8");t["a"]={data:function(){return{start:1,limit:10,page:{currentPage:1,size:10,total:0,pageSizes:[10,20,30,40]},loadingOption:{background:"rgba(255,255,255,.9)",text:"拼了老命加载中.....",spinner:"el-icon-loading"},uploadUrl:"/lejuAdmin/material/uploadFileOss"}},methods:{handleSizeChange:function(e){this.page.size=e,this.page.currentPage=1,this.init()},handleCurrentChange:function(e){this.page.currentPage=e,this.init()}},computed:{headers:function(){var e=Object(a["b"])(),t={token:e};return t}}}},"343c":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-main"},[s("el-card",{staticClass:"search-bar card",attrs:{shadow:"never"}},[s("el-form",{ref:"searchForm",attrs:{model:e.search,"label-width":"80px",inline:!1,size:"mini"}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:6,offset:0}},[s("el-form-item",{attrs:{label:"昵称",size:"mini",prop:"nickName"}},[s("el-input",{attrs:{placeholder:"昵称模糊搜索",size:"mini",clearable:""},model:{value:e.search.nickName,callback:function(t){e.$set(e.search,"nickName",t)},expression:"search.nickName"}})],1)],1),s("el-col",{attrs:{span:6,offset:0}},[s("el-form-item",{attrs:{label:"用户名",size:"mini",prop:"username"}},[s("el-input",{attrs:{placeholder:"用户名模糊搜索",size:"mini",clearable:""},model:{value:e.search.username,callback:function(t){e.$set(e.search,"username",t)},expression:"search.username"}})],1)],1)],1),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:6,offset:18}},[s("el-button",{attrs:{type:"default",size:"mini"},on:{click:e.doReset}},[e._v("重置")]),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.doSearch}},[e._v("查询")])],1)],1)],1)],1),s("div",{staticClass:"container"},[s("el-card",{staticClass:"card",attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.goAdd}},[e._v("新增")])],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userList,border:"",stripe:""}},[s("el-table-column",{attrs:{label:"#",type:"index",width:"50",fixed:""}}),s("el-table-column",{attrs:{label:"用户名",prop:"username",width:"200",fixed:""}}),s("el-table-column",{attrs:{label:"昵称",prop:"nick_name",width:"200"}}),s("el-table-column",{attrs:{label:"头像",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("img",{staticClass:"avatar-img",attrs:{src:e.row.salt,alt:""}})]}}])}),s("el-table-column",{attrs:{label:"角色",prop:"roles"}}),s("el-table-column",{attrs:{label:"添加时间",prop:"create_time",width:"200"}}),s("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(s){return e.goEdit(t.row.id)}}},[e._v("编辑")]),s("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(s){return e.doDel(t.row.id)}}},[e._v("删除")])]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"30px","text-align":"right"},attrs:{"current-page":e.page.start,"page-sizes":e.page.sizes,"page-size":e.page.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.page.totalCount},on:{"update:currentPage":function(t){return e.$set(e.page,"start",t)},"update:current-page":function(t){return e.$set(e.page,"start",t)},"size-change":e.sizeChange,"current-change":e.currentChange}})],1)],1),s("UserForm",{ref:"userForm",attrs:{"role-list":e.roleList},on:{refresh:e.getUserList}})],1)},r=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-form"},[s("el-dialog",{attrs:{title:"编辑用户",visible:e.dialog,width:"30%"},on:{"update:visible":function(t){e.dialog=t},close:e.handleClose}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px",inline:!1,size:"normal"}},[s("el-form-item",{attrs:{label:"用户名",prop:"username"}},[s("el-input",{attrs:{readonly:e.form.id.length>0,size:"small"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),s("el-form-item",{attrs:{label:"用户昵称",prop:"nickName"}},[s("el-input",{attrs:{size:"small"},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),e.form.id?e._e():s("el-form-item",{attrs:{label:"密码"}},[s("el-input",{attrs:{type:"password",size:"small"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),s("el-form-item",{attrs:{label:"用户头像"}},[s("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,headers:e.headers,"show-file-list":!1,"on-success":e.handleImgSuccess,"before-upload":e.beforeAvatarUpload}},[s("el-avatar",{attrs:{icon:"el-icon-user-solid",src:e.form.salt}})],1)],1),s("el-form-item",{attrs:{label:"选择角色",prop:"username"}},[s("el-select",{attrs:{size:"small","value-key":"id",clearable:"",multiple:""},model:{value:e.form.roleIds,callback:function(t){e.$set(e.form,"roleIds",t)},expression:"form.roleIds"}},e._l(e.roleList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1)],1),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取消")]),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.doSave}},[e._v("确定")])],1)],1)],1)},n=[],o=(s("ac1f"),s("00b4"),s("99af"),s("b775"));function l(){return Object(o["a"])({url:"/admin/sysAuth/role/findAllRoles"})}function c(e,t,s){return Object(o["a"])({url:"/admin/sysAuth/user/findUsersByPage/".concat(e,"/").concat(t),method:"post",data:s})}function u(e){return Object(o["a"])({url:"/admin/sysAuth/user/".concat(e)})}function m(e){return Object(o["a"])({url:"/admin/sysAuth/user/removeUser/".concat(e),method:"DELETE"})}function d(e){return Object(o["a"])({url:"/admin/sysAuth/user/updateUserRoles",method:"PUT",data:e})}function f(e){return Object(o["a"])({url:"/admin/sysAuth/user/saveUserRoles",method:"post",data:e})}var p=s("1b62"),g={name:"AuthUser",mixins:[p["a"]],props:{roleList:{type:Array,required:!0}},data:function(){return{treeLoad:!1,dialog:!1,form:{id:"",salt:"",roleIds:[],username:"",nickName:""},rules:{username:[{required:!0,message:"用户名名称不能为空",trigger:"blur"}],nickName:[{required:!0,message:"昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}]}}},computed:{},created:function(){},methods:{openDialog:function(e){var t=this;this.dialog=!0,e&&(this.treeLoad=!0,u(e).then((function(e){e.success?(t.form=e.data.user,console.log(t.form)):t.$message.error("查询失败!"),t.treeLoad=!1})))},handleClose:function(){this.dialog=!1,this.form=this.$options.data().form},handleImgSuccess:function(e,t){console.log(e),e.success?(this.form.salt=e.data.fileUrl,this.$message.success(e.message)):this.$message.error(e.message)},beforeAvatarUpload:function(e){var t=/image\/(jpeg|png|gif|webp)/gi,s=t.test(e.type),a=e.size/1024/1024<2;return s||this.$message.error("上传头像图片只能是 jpeg|png|gif|webp 格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),s&&a},doSave:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return e.$message.error("请注意表单验证!"),!1;var s=null;s=e.form.id?d:f,s(e.form).then((function(t){t.success?(e.$message.success("保存成功!"),e.handleClose(),e.$emit("refresh")):e.$message.error(t.message)}))}))}}},h=g,b=s("2877"),v=Object(b["a"])(h,i,n,!1,null,"69f96bbd",null),k=v.exports,w={name:"AuthUser",components:{UserForm:k},data:function(){return{loading:!1,search:{nickName:"",username:""},userList:[],roleList:[],page:{start:1,limit:10,sizes:[10,20,30,40],totalCount:0}}},created:function(){this.getUserList(),this.getRoleList()},methods:{getRoleList:function(){var e=this;l().then((function(t){e.roleList=t.data.items}))},getUserList:function(){var e=this;this.loading=!0,c(this.page.start,this.page.limit).then((function(t){t.success?(e.userList=t.data.rows,e.page.totalCount=t.data.total):e.$message.error(t.message),e.loading=!1}))},goAdd:function(){this.$refs.userForm.openDialog()},goEdit:function(e){this.$refs.userForm.openDialog(e)},doDel:function(e){var t=this;this.$confirm("确认删除?").then((function(s){m(e).then((function(e){e.success?(t.$message.success("删除成功!"),t.getUserList()):t.$message.error(e.message)}))}))},doReset:function(){this.$refs.searchForm.resetFields()},doSearch:function(){},sizeChange:function(e){this.page.limit=e,this.getUserList()},currentChange:function(e){this.page.start=e,this.getUserList()}}},z=w,y=(s("9f6e"),Object(b["a"])(z,a,r,!1,null,"0dcbb1e1",null));t["default"]=y.exports},"9f6e":function(e,t,s){"use strict";s("b797")},b797:function(e,t,s){}}]);